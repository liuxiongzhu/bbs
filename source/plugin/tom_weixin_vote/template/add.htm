<!DOCTYPE html>
<html>
<head>
<!--{if $isGbk}-->
<meta http-equiv="Content-Type" content="text/html; charset=GBK">
<!--{else}-->
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<!--{/if}-->
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0 , maximum-scale=1.0, user-scalable=0">
<title>{lang tom_weixin_vote:add_title}-{$voteInfo['title']}</title>
<meta name="format-detection" content="telephone=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<link href="source/plugin/tom_weixin_vote/images/style.css?v={$cssJsVersion}" rel="stylesheet" type="text/css">
<script language="javascript" src="source/plugin/tom_weixin_vote/images/jquery-1.8.3.min.js"></script>
<script language="javascript" src="source/plugin/tom_weixin_vote/images/ajaxfileupload.js"></script>
<script language="javascript" src="source/plugin/tom_weixin_vote/images/buildfileupload.js"></script>
<script type="text/javascript">
    var commonjspath = 'source/plugin/tom_weixin_vote/images';
</script>
<script src="source/plugin/tom_weixin_vote/images/common.js" type="text/javascript"></script>
<base target="_self">
<style>
.add_form_box_main table td li {
  float: left;
  width: 25%;
  height: 80px;
  text-align: center;
}
.add_form_box_main table td li img {
  height: 60px;
  width: 60px;
}
</style>
</head>
<body>
<header class="header_style clearfix">
	<a href="javascript:history.go(-1);"></a>
	<h1 style="color: {$voteBgColor};">{lang tom_weixin_vote:add_title}</h1>
</header>
<!--{if $voteConfig['open_add_pwd'] == 0 }-->
<section class="add_top_box clearfix">
	<a href="plugin.php?id=tom_weixin_vote&mod=login&vid={$vid}" style="color: {$voteBgColor};">{lang tom_weixin_vote:add_login_title}</a>
</section>
<!--{/if}-->
<section class="add_form_box clearfix">
	<div class="add_form_box_main clearfix">
        <!--{if $voteInfo['bm_status'] == 1}-->
        <form id="addFrom" action="" method="post" enctype="multipart/form-data" onsubmit="return false;">
    	<table width="100%" border="0" cellpadding="0" cellspacing="0">
        	<tr>
            	<td width="30%"><label class="c1">{$voteInfo['item_obj_name']}</label></td>
            	<td><input type="text" class="input_class" name="bmname" id="bmname" placeholder="{lang tom_weixin_vote:add_tianxie}{$voteInfo['item_obj_name']}"/></td>
            </tr>
            <tr>
            	<td><label class="c1">{lang tom_weixin_vote:add_tel}</label></td>
            	<td><input type="text" class="input_class" name="bmtel" id="bmtel" placeholder="{lang tom_weixin_vote:add_tianxie}{lang tom_weixin_vote:add_tel}"/></td>
            </tr>
            <!--{if $voteConfig['open_add_pwd'] == 0 }-->
            <tr>
            	<td><label class="c1">{lang tom_weixin_vote:add_pwd}</label></td>
            	<td><input type="text" class="input_class" name="bmpwd" id="bmpwd" placeholder="{lang tom_weixin_vote:add_tianxie}{lang tom_weixin_vote:add_pwd}"/></td>
            </tr>
            <tr>
            	<td colspan="2" style="line-height:20px;height:20px;"><label class="c3" style="line-height:20px;height:20px; font-size: 13px;color: {$voteBgColor};  text-align: center;">{lang tom_weixin_vote:add_pwd_msg}</label></td>
            </tr>
            <!--{/if}-->
            <tr>
            	<td><label class="c1">{lang tom_weixin_vote:add_desc}</label></td>
            	<td><textarea class="textarea_class" name="bmdesc" id="bmdesc" placeholder="{lang tom_weixin_vote:add_tianxie}{lang tom_weixin_vote:add_desc}" cols="" rows=""></textarea></td>
            </tr>
            <tr>
            	<td><label class="c1">{lang tom_weixin_vote:add_pic1}<br/>{lang tom_weixin_vote:add_zhang1}{$voteConfig['pic_num']}{lang tom_weixin_vote:add_zhang2}</label></td>
            	<td>
                    <input type="file" name="filedata1" id="filedata1" class="file_class" accept="image/*" capture="camera" />
                    <input type="hidden" name="bmpicurl" id="bmpicurl" value="">
                    <span id="picSpan"></span>
                </td>
            </tr>
            <tr>
            	<td colspan="2">
                	<ul id="preview">
                    </ul>
                </td>
            </tr>
            <tr>
            	<td colspan="2" style="line-height:20px;"><label class="c3" style="min-height:20px;line-height:20px;color: #949090;">{$voteInfo['pic_err_msg']}</label></td>
            </tr>
            <!--{if $size == 1}-->
            <tr>
            	<td colspan="2"><label class="c3"><a>{lang tom_weixin_vote:over_pic_size}</a></label></td>
            </tr>
            <!--{/if}-->
            <tr>
            	<td colspan="2">
                    <input type="hidden" name="formhash" value="{$formhash}">
                    <input type="hidden" name="tomhash" value="{$tomhash}">
                    <input type="hidden" name="vid" value="{$vid}">
                    <input type="hidden" name="act" value="add">
                    <input name="dosubmit" class="id_add_form_btn btn_class" style="background-color: {$voteBgColor};" type="button" value="{lang tom_weixin_vote:add_btn}">
                </td>
            </tr>
        </table>
        </form>
        <!--{else}-->
        <table width="100%" border="0" cellpadding="0" cellspacing="0">
            <tr>
                    <td colspan="2"><label class="c3" style="height: 60px;line-height: 25px;"><a>{$voteConfig['close_bm_msg']}</a></label></td>
            </tr>
        </table>    
        <!--{/if}-->
    </div>
</section>
<!--{if $open_tousu == 1}-->
<section id="tousu" style=" z-index:9999; text-align:center; border-top-right-radius: 100%; border-bottom-right-radius: 100%; border:1px solid #ccc; background:#403e3e; position:fixed; bottom:20%; left:-24px; width:50px; padding:10px 0 10px 12px;"><a style="display:block; color:#fff; font-size:16px; line-height:25px; font-family: fantasy;" href="{$tousuUrl}">{lang tom_weixin_vote:tousu_msg_1}<br/>{lang tom_weixin_vote:tousu_msg_2}</a></section>
<!--{/if}-->
<script>
    
var li_i = 1;
var count = 0;
var allow_num = "{$voteConfig['pic_num']}";
allow_num = allow_num*1;

$(document).on('change', '#filedata1', function() {
    loading('{lang tom_weixin_vote:upload_doing}');
    uploadsuccess = function(data) {
        if(data == '') {
            loading(false);
            tusi('{lang tom_weixin_vote:upload_error}');
        }
        var dataarr = data.split('|');
        dataarr[0] = $.trim(dataarr[0]);
        if(dataarr[0] == 'OK') {
            loading(false);
            //$("#bmpicurl").val(dataarr[2]);
            //$("#picSpan").html('<img width="30" height="30" src="'+dataarr[1]+'">');
            var picHtml = '<li class="li_'+li_i+'">'
                +'<img src="'+dataarr[1]+'"/><input type="hidden" name="bmpicli_'+li_i+'" value="'+dataarr[2]+'">'
                +'<p><a href="javascript:void(0);" onclick="myremove('+li_i+');" style="font-size: 10em;">[{lang tom_weixin_vote:photo_del}]</a></p>'
                +'</li>';
            $("#preview").append(picHtml);
            li_i++;
            count++;
        }else if(dataarr[0] == 'SIZE'){
            loading(false);
            tusi('{lang tom_weixin_vote:upload_max_size}');
        } else {
            loading(false);
            tusi('{lang tom_weixin_vote:upload_error}');
        }
    };
    <!--{if $voteConfig['pic_yasu'] == 1}-->
    $.buildfileupload({
        uploadurl:'{$uploadUrl}',
        files:this.files,
        uploadformdata:{uid:"1"},
        uploadinputname:'filedata1',
        maxfilesize:"2000",
        success:uploadsuccess,
        error:function() {
            loading(false);
            tusi('{lang tom_weixin_jy:upload_error}');
        }
    });
    <!--{else}-->
    $.ajaxfileupload({
        url:'{$uploadUrl}',
        data:{uid:"1"},
        dataType:'text',
        fileElementId:'filedata1',
        success:uploadsuccess,
        error: function() {
            loading(false);
            tusi('{lang tom_weixin_vote:upload_error}');
        }
    });
    <!--{/if}-->
});

function myremove(i){
    $(".li_"+i).remove();
    count--;
}
var submintAddformStatus = 0;
$(".id_add_form_btn").click( function () { 
    var bmname = $("#bmname").val();
    var bmtel = $("#bmtel").val();
    var bmpwd = $("#bmpwd").val();
    var bmdesc = $("#bmdesc").val();
    var bmpicurl = $("#bmpicurl").val();
    
    if(submintAddformStatus == 1){
        return false;
    }
    if(bmname == ""){
        tusi("{lang tom_weixin_vote:add_must_tianxie}{$voteInfo['item_obj_name']}");
        return false;
    }
    if(bmtel == '' || !checkMobile(bmtel)){
        tusi("{lang tom_weixin_vote:add_must_tel}");
        return false;
    }
    <!--{if $voteConfig['open_add_pwd'] == 0 }-->
    if(bmpwd == ""){
        tusi("{lang tom_weixin_vote:add_must_tianxie}{lang tom_weixin_vote:add_pwd}");
        return false;
    }
    <!--{/if}-->
    if(bmdesc == ""){
        tusi("{lang tom_weixin_vote:add_must_tianxie}{lang tom_weixin_vote:add_desc}");
        return false;
    }
    if(count > allow_num){
        tusi("{lang tom_weixin_vote:add2_pic_error1}");
        return false;
    }
    if(count == 0){
        tusi("{lang tom_weixin_vote:add2_pic_error2}");
        return false;
    }
    submintAddformStatus = 1;
    $.ajax({
        type: "POST",
        url: "{$saveUrl}",
        data: $('#addFrom').serialize(),
        success: function(msg){
            submintAddformStatus = 0;    
            msg = $.trim(msg);
            if(msg == '201'){
                tusi("{lang tom_weixin_vote:add_login_title}");
                setTimeout(function(){window.location="{$loginUrl}";},1888);
            }else if(msg == '200'){
                tusi("{lang tom_weixin_vote:add_success}");
                setTimeout(function(){document.location.reload();},1888);
            }else{
                tusi("{lang tom_weixin_vote:add_error}");
                setTimeout(function(){document.location.reload();},1888);
            }
        }
    });
});
function checkMobile(s){
	var regu =/^[1][3|8|4|5|7][0-9]{9}$/;
	var re = new RegExp(regu);
	if (re.test(s)) {
		return true;
	}else{
		return false;
	}
} 
</script>
</body>
</html>
